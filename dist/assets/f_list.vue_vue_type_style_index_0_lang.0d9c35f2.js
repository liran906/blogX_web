import{d as ae,b as g,a as M,r as u,o as l,c,w as d,M as F,x as C,f as y,e as v,g as Z,F as O,i as w,h as U,j as he,u as A,aC as be,aD as ge,aE as ke,k as E,t as K,O as we,aF as V}from"./index.2bfdadc6.js";import{c as te}from"./date.a44b248f.js";import{_ as Ve}from"./options.9d69dd6c.js";const Fe=ae({__name:"f_modal_form",props:{visible:{type:Boolean},formList:{},addLabel:{},editLabel:{}},emits:["update:visible","create","update"],setup(q,{expose:H,emit:J}){const s=q,$=g([]);async function Q(){$.value=[];for(const r of s.formList){if(typeof r.source=="function"){const k=await r.source();if(k.code){F.error(k.msg);continue}r.options=k.data}else r.options=r.source;$.value.push(r)}}Q();const N=J;function x(){G.value.clearValidate(),G.value.resetFields(),_.value=!1,N("update:visible",!1)}const i=M({}),G=g();async function W(){if(await G.value.validate())return!1;const k=L=>{if(L){x();return}};_.value?N("update",i,k):N("create",i,k)}const _=g(!1);function X(r){_.value=!0,Object.assign(i,r)}return H({setForm:X}),(r,k)=>{const L=u("a-input"),B=u("a-select"),h=u("a-switch"),p=u("a-radio-group"),P=u("a-textarea"),Y=u("a-form-item"),z=u("a-form"),R=u("a-modal");return l(),c(R,{title:_.value&&r.editLabel?r.editLabel:r.addLabel,visible:s.visible,onCancel:x,"on-before-ok":W},{footer:d(()=>[C(r.$slots,"footer",{form:i})]),default:d(()=>[y(z,{ref_key:"formRef",ref:G,model:i},{default:d(()=>[(l(!0),v(O,null,Z($.value,t=>(l(),v(O,null,[!_.value||_.value&&!t.editDisable?(l(),c(Y,{key:0,field:t.field,label:t.label,rules:t.rules,"validate-trigger":t.validateTrigger},{help:d(()=>[C(r.$slots,`${t.field}_help`,{value:i[t.field]})]),default:d(()=>[t.type==="input"||t.type==="password"?(l(),c(L,{key:0,modelValue:i[t.field],"onUpdate:modelValue":m=>i[t.field]=m,type:t.type==="input"?"text":"password",placeholder:t.label},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):t.type==="select"?(l(),c(B,{key:1,multiple:t.multiple,modelValue:i[t.field],"onUpdate:modelValue":m=>i[t.field]=m,placeholder:t.label,options:t.options,"allow-clear":""},null,8,["multiple","modelValue","onUpdate:modelValue","placeholder","options"])):t.type==="switch"?(l(),c(h,{key:2,modelValue:i[t.field],"onUpdate:modelValue":m=>i[t.field]=m},null,8,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(l(),c(p,{key:3,modelValue:i[t.field],"onUpdate:modelValue":m=>i[t.field]=m,options:t.options},null,8,["modelValue","onUpdate:modelValue","options"])):t.type==="textarea"?(l(),c(P,{key:4,modelValue:i[t.field],"onUpdate:modelValue":m=>i[t.field]=m,placeholder:t.label,"allow-clear":"","auto-size":t.autoSize},null,8,["modelValue","onUpdate:modelValue","placeholder","auto-size"])):C(r.$slots,t.field,{key:5,form:i})]),_:2},1032,["field","label","rules","validate-trigger"])):w("",!0)],64))),256))]),_:3},8,["model"])]),_:3},8,["title","visible"])}}}),Ce={class:"f_list_com"},Le={class:"f_list_head"},Be={key:0,class:"action_create"},De={key:0,class:"action_group"},Ue={class:"action_filter"},Ae={class:"action_search_slot"},$e={class:"f_list_body"},Ge={class:"f_list_table"},Pe={key:0,class:"col_actions"},Ne={key:1},Se={key:0,class:"f_list_page"},xe=ae({__name:"f_list",props:{url:{type:Function},columns:{},rowKey:{},defaultParams:{},actionGroup:{},filterGroup:{},limit:{},noDefaultDelete:{type:Boolean},noBatchDelete:{type:Boolean},noAdd:{type:Boolean},noEdit:{type:Boolean},noDelete:{type:Boolean},noActionGroup:{type:Boolean},noCheck:{type:Boolean},noPage:{type:Boolean},searchPlaceholder:{},addLabel:{},editLabel:{},deleteLabel:{},formList:{},addFormLabel:{},editFormLabel:{}},emits:["delete","add","edit","row-click"],setup(q,{expose:H,emit:J}){const s=q,{rowKey:$="id",noDefaultDelete:Q=!1,searchPlaceholder:N="\u641C\u7D22",addLabel:x="\u6DFB\u52A0",editLabel:i="\u7F16\u8F91",deleteLabel:G="\u5220\u9664",limit:W=10}=s,_=g([]);function X(){let e=0;s.noBatchDelete||(_.value.push({label:"\u6279\u91CF\u5220\u9664",value:1,callback:n=>{z(n),j.value=[]}}),e=1),e++;const o=s.actionGroup||[];for(const n of o)_.value.push({label:n.label,value:e,callback:n.callback})}X();const r=g([]);async function k(){r.value=[];for(const e of s.filterGroup||[]){if(typeof e.source=="function"){const o=await e.source(e.params);if(o.code){F.error(o.msg);continue}e.options=o.data}else e.options=e.source;e.callback||(e.callback=o=>{if(e.column){const n={};n[e.column]=o,p(n)}}),r.value.push(e)}}k();const L=g(!1),B=M({list:[],count:0}),h=M({limit:s.noPage?-1:W});async function p(e){s.defaultParams&&Object.assign(h,s.defaultParams),L.value=!0,e&&Object.assign(h,e);const o=await s.url(h);if(L.value=!1,o.code){F.error(o.msg);return}B.list=o.data.list,B.count=o.data.count}p();const P=J;async function Y(e){const o=e[$];z([o])}async function z(e){if(Q){P("delete",e);return}const o=/\"(.*?)\"/.exec(s.url.toString());if((o==null?void 0:o.length)!==2)return;const n=o[1],b=await be(n,e);if(b.code){F.error(b.msg);return}p(),F.success(b.msg)}const R=g();function t(e){var o;if((o=s.formList)!=null&&o.length){R.value.setForm(e),T.value=!0;return}P("edit",e)}function m(){var e;if((e=s.formList)!=null&&e.length){T.value=!0;return}P("add")}function le(){p()}function ee(){p()}function ne(){p(),F.success("\u5237\u65B0\u6210\u529F")}const j=g([]),se=M({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),I=g();function re(){const e=_.value.find(o=>o.value===I.value);e&&e.callback(j.value)}function ie(e,o){P("row-click",e)}const T=g(!1);async function ue(e,o){const n=/\"(.*?)\"/.exec(s.url.toString());if((n==null?void 0:n.length)!==2)return;const b=n[1],D=await ge(b,e);if(D.code){F.error(D.msg);return}p(),o(!0)}async function ce(e,o){const n=/\"(.*?)\"/.exec(s.url.toString());if((n==null?void 0:n.length)!==2)return;const b=n[1],D=await ke(b,e);if(D.code){F.error(D.msg);return}p(),o(!0)}return H({getList:p,data:B}),(e,o)=>{var oe;const n=u("a-button"),b=u("a-select"),D=u("a-input-search"),de=u("icon-refresh"),S=u("a-table-column"),pe=u("a-switch"),fe=u("a-popconfirm"),_e=u("a-table"),me=u("a-pagination"),ye=u("a-spin");return l(),v("div",Ce,[(oe=s.formList)!=null&&oe.length?(l(),c(Fe,{key:0,ref_key:"modalFormRef",ref:R,onCreate:ue,onUpdate:ce,"add-label":s.addFormLabel,"edit-label":s.editFormLabel,visible:T.value,"onUpdate:visible":o[0]||(o[0]=a=>T.value=a),"form-list":s.formList},null,8,["add-label","edit-label","visible","form-list"])):w("",!0),U("div",Le,[C(e.$slots,"action_add",{},()=>[e.noAdd?w("",!0):(l(),v("div",Be,[y(n,{type:"primary",onClick:m},{default:d(()=>[E(K(A(x)),1)]),_:1})]))]),e.noActionGroup?w("",!0):(l(),v("div",De,[y(b,{style:{width:"140px"},placeholder:"\u64CD\u4F5C",modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=a=>I.value=a),options:_.value},null,8,["modelValue","options"]),I.value?(l(),c(n,{key:0,type:"primary",status:"danger",onClick:re},{default:d(()=>o[5]||(o[5]=[E("\u6267\u884C")])),_:1,__:[5]})):w("",!0)])),U("div",{class:"action_search",onKeydown:he(ee,["enter"])},[y(D,{placeholder:A(N),modelValue:h.key,"onUpdate:modelValue":o[2]||(o[2]=a=>h.key=a),onSearch:ee},null,8,["placeholder","modelValue"])],32),U("div",Ue,[(l(!0),v(O,null,Z(r.value,a=>(l(),c(b,{style:we({width:a.width+"px"}),"allow-clear":"",onChange:a.callback,placeholder:a.label,options:a.options},null,8,["style","onChange","placeholder","options"]))),256))]),U("div",Ae,[C(e.$slots,"search_other")]),U("div",{class:"action_flush",onClick:ne},[y(de,{onClick:p})])]),U("div",$e,[y(ye,{loading:L.value,tip:"\u52A0\u8F7D\u4E2D..."},{default:d(()=>[U("div",Ge,[y(_e,{onRowClick:ie,data:B.list,"row-key":A($),selectedKeys:j.value,"onUpdate:selectedKeys":o[3]||(o[3]=a=>j.value=a),"row-selection":s.noCheck?void 0:se,pagination:!1},{columns:d(()=>[(l(!0),v(O,null,Z(s.columns,a=>(l(),v(O,null,[a.type==="date"?(l(),c(S,V({key:0,ref_for:!0},a),{cell:d(f=>[E(K(A(te)(f.record[a.dataIndex],a.dateFormat)),1)]),_:2},1040)):a.type==="options"?(l(),c(S,V({key:1,ref_for:!0},a),{cell:d(f=>[y(Ve,{options:a.options,value:f.record[a.dataIndex]},null,8,["options","value"])]),_:2},1040)):a.type==="switch"?(l(),c(S,V({key:2,ref_for:!0},a),{cell:d(f=>[y(pe,{"model-value":f.record[a.dataIndex]},null,8,["model-value"])]),_:2},1040)):a.slotName?(l(),c(S,V({key:3,ref_for:!0},a),{cell:d(f=>[a.slotName==="action"?(l(),v("div",Pe,[C(e.$slots,"action_left",V({ref_for:!0},f)),e.noEdit?w("",!0):(l(),c(n,{key:0,type:"primary",onClick:ve=>t(f.record)},{default:d(()=>[E(K(A(i)),1)]),_:2},1032,["onClick"])),e.noDelete?w("",!0):(l(),c(fe,{key:1,onOk:ve=>Y(f.record),content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8BB0\u5F55\u5417\uFF1F"},{default:d(()=>[y(n,{type:"primary",status:"danger"},{default:d(()=>[E(K(A(G)),1)]),_:1})]),_:2},1032,["onOk"])),C(e.$slots,"action_right",V({ref_for:!0},f))])):w("",!0),a.slotName==="createdAt"?(l(),v("div",Ne,K(A(te)(f.record[a.slotName],a.dateFormat)),1)):C(e.$slots,a.slotName,V({key:2,ref_for:!0},f))]),_:2},1040)):(l(),c(S,V({key:4,ref_for:!0},a),null,16))],64))),256))]),_:3},8,["data","row-key","selectedKeys","row-selection"])]),s.noPage?w("",!0):(l(),v("div",Se,[y(me,{"show-total":"",onChange:le,total:B.count,current:h.page,"onUpdate:current":o[4]||(o[4]=a=>h.page=a),"page-size":h.limit},null,8,["total","current","page-size"])]))]),_:3},8,["loading"])])])}}});export{xe as _};
