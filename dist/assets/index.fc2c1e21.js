import{_ as J,F as P}from"./f_main.50a5a2c1.js";import{o as G,M as Q}from"./index.c242c0de.js";import{m as W,n as X,h as Y,o as Z}from"./article_api.17d37d9d.js";import{d as N,p as O,a as U,b as x,r as k,o as r,c as $,w as y,f as d,h as e,e as b,g as z,k as F,t as g,i as A,F as M,M as c,n as T,u as a,y as ee,H as K,j as te,l as oe,a8 as ne,ap as se,J as ie,A as j,s as q}from"./index.38238af8.js";import{d as le,a as ae}from"./date.b51fef5c.js";import{_ as ce,c as ue}from"./f_collect_form_modal.vue_vue_type_script_setup_true_lang.514dee07.js";import{c as H,d as re,b as de,e as me}from"./comment_api.d30182d4.js";import{_ as _e,a as pe}from"./options.ab31759e.js";import{g as V,b as fe}from"./go_router.fe7c6f8b.js";import"./f_theme.vue_vue_type_script_setup_true_lang.314650f9.js";import"./_plugin-vue_export-helper.cdc0426e.js";const ve={class:"list"},Ce={class:"item"},ge={class:"left"},ke={class:"title"},ye={class:"count"},De=N({__name:"f_article_collect_modal",props:{visible:{type:Boolean},articleId:{}},emits:["update:visible","select"],setup(h,{emit:E}){const f=O(),m=h,t=E,u=U({list:[],count:0});function B(){t("update:visible",!1)}async function D(){u.list=[],u.count=0;const p=await ue({articleID:m.articleId});if(p.code){c.error(p.msg);return}Object.assign(u,p.data),u.list.length===0&&u.list.push({id:0,createdAt:"",updatedAt:"",title:"\u9ED8\u8BA4\u6536\u85CF\u5939",abstract:"",coverURL:"",userID:f.userInfo.userID,isDefault:!0,articleCount:0,articleUse:!1})}U({});const I=x("");function _(){n.value=!0}const n=x(!1);function s(p){t("select",p.id),B()}return(p,v)=>{const w=k("a-tag"),L=k("a-button"),l=k("a-modal");return r(),$(l,{footer:!1,"body-class":"collect_modal_body scrollbar",title:"\u6536\u85CF\u6587\u7AE0",onBeforeOpen:D,onCancel:B,visible:m.visible},{default:y(()=>[d(ce,{title:I.value,"onUpdate:title":v[0]||(v[0]=o=>I.value=o),visible:n.value,"onUpdate:visible":v[1]||(v[1]=o=>n.value=o),onOk:D},null,8,["title","visible"]),e("div",{class:"add"},[e("div",{class:"inner",onClick:_},v[2]||(v[2]=[e("i",{class:"iconfont icon-jia"},null,-1),e("span",null,"\u521B\u5EFA\u6536\u85CF\u5939",-1)]))]),e("div",ve,[(r(!0),b(M,null,z(u.list,o=>(r(),b("div",Ce,[e("div",ge,[e("div",ke,[F(g(o.title)+" ",1),o.isDefault?(r(),$(w,{key:0,color:"blue"},{default:y(()=>v[3]||(v[3]=[F("\u9ED8\u8BA4\u6536\u85CF\u5939")])),_:1,__:[3]})):A("",!0)]),e("div",ye,g(o.articleCount)+"\u7BC7\u6587\u7AE0",1)]),d(L,{onClick:R=>s(o),type:"primary",status:o.articleUse?"danger":"",size:"mini"},{default:y(()=>[F(g(o.articleUse?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"),1)]),_:2},1032,["onClick","status"])]))),256))])]),_:1},8,["visible"])}}});const Be=["onClick"],Ie=["onClick"],be={key:0,class:"action"},Fe=["onClick"],Ae={key:0,class:"apply_comment"},$e=N({__name:"comment_tree",props:{list:{},line:{}},emits:["ok"],setup(h,{emit:E}){const f=O(),m=E,t=h;function u(n){n.isApply=!n.isApply,n.isApply&&ee(()=>{document.querySelector(`.apply_comment_ipt_${n.id} input`).focus()})}async function B(n){var p;if(((p=n.replyContent)==null?void 0:p.trim())===""){c.warning("\u8BF7\u8F93\u5165\u56DE\u590D\u5185\u5BB9");return}const s=await H({content:n.replyContent,articleID:n.articleID,parentID:n.id});if(s.code){c.error(s.msg);return}c.success(s.msg),m("ok")}function D(){m("ok")}async function I(n){const s=await re(n.id);if(s.code){c.error(s.msg);return}c.success(s.msg),n.isLiked=!n.isLiked,n.isLiked?n.likeCount++:n.likeCount--}async function _(n){const s=await de(n.id);if(s.code){c.error(s.msg);return}c.success(s.msg),m("ok")}return(n,s)=>{const p=k("IconDelete"),v=k("a-popconfirm"),w=k("a-avatar"),L=k("a-input"),l=k("a-button"),o=k("comment_tree",!0),R=k("a-comment");return r(!0),b(M,null,z(t.list,i=>(r(),$(R,{class:"comment_tree_com",content:i.content,datetime:a(le)(i.createdAt)},{actions:y(()=>[e("span",{class:T(["action",{active:i.isLiked}]),onClick:C=>I(i)},[s[0]||(s[0]=e("i",{class:"iconfont icon-dianzan_kuai"},null,-1)),F(" \u70B9\u8D5E\uFF08"+g(i.likeCount)+"\uFF09 ",1)],10,Be),t.line!=a(f).siteInfo.article.commentLine?(r(),b("span",{key:0,class:"action",onClick:C=>u(i)},[s[1]||(s[1]=e("i",{class:"iconfont icon-pinglun1"},null,-1)),F(" \u56DE\u590D\uFF08"+g(i.replyCount)+"\uFF09 ",1)],8,Ie)):A("",!0),d(v,{content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u8BC4\u8BBA\u5417\uFF1F",onOk:C=>_(i)},{default:y(()=>[i.userID===a(f).userInfo.userID?(r(),b("span",be,[e("i",null,[d(p)]),s[2]||(s[2]=F(" \u5220\u9664 "))])):A("",!0)]),_:2},1032,["onOk"])]),author:y(()=>[e("span",{onClick:C=>a(V)(i.userID)},g(i.userNickname),9,Fe),i.userID!==a(f).userInfo.userID&&i.relation!==1?(r(),$(_e,{key:0,style:{"margin-left":"10px"},options:a(pe),value:i.relation},null,8,["options","value"])):A("",!0)]),avatar:y(()=>[d(w,{onClick:C=>a(V)(i.userID),"image-url":i.userAvatarURL},null,8,["onClick","image-url"])]),default:y(()=>{var C;return[i.isApply?(r(),b("div",Ae,[d(L,{modelValue:i.replyContent,"onUpdate:modelValue":S=>i.replyContent=S,class:T(`apply_comment_ipt_${i.id}`),placeholder:`\u56DE\u590D${i.userNickname}`},null,8,["modelValue","onUpdate:modelValue","class","placeholder"]),d(l,{type:"primary",onClick:S=>B(i)},{default:y(()=>s[3]||(s[3]=[F("\u56DE\u590D")])),_:2,__:[3]},1032,["onClick"])])):A("",!0),(C=i.childComments)!=null&&C.length?(r(),$(o,{key:1,line:t.line+1,onOk:D,list:i.childComments},null,8,["line","list"])):A("",!0)]}),_:2},1032,["content","datetime"]))),256)}}});const Ee={class:"article_comment_com"},he={class:"add_comment"},we={class:"comment_list"},xe=N({__name:"article_comment",props:{articleId:{}},setup(h,{expose:E}){const f=h,m=U({list:[],count:0});async function t(){const _=await me(f.articleId);if(_.code){c.error(_.msg);return}m.list=_.data.list,m.count=_.data.count}const u=U({content:"",articleID:f.articleId,parentID:void 0});async function B(){if(u.articleID=f.articleId,u.content.trim()===""){c.warning("\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9");return}const _=await H(u);if(_.code){c.error(_.msg);return}c.success(_.msg),t(),u.content=""}K(()=>f.articleId,()=>{t()},{immediate:!0});const D=x();function I(){D.value.focus()}return E({focus:I}),(_,n)=>{const s=k("a-textarea"),p=k("a-button");return r(),b("div",Ee,[e("div",he,[d(s,{modelValue:u.content,"onUpdate:modelValue":n[0]||(n[0]=v=>u.content=v),ref_key:"textareaRef",ref:D,onKeydown:te(B,["enter"]),"auto-size":{minRows:5,maxRows:6},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9"},null,8,["modelValue"]),d(p,{type:"primary",onClick:B,size:"mini"},{default:y(()=>n[1]||(n[1]=[F("\u53D1\u5E03\u8BC4\u8BBA")])),_:1,__:[1]})]),e("div",we,[d($e,{line:1,onOk:t,list:m.list},null,8,["list"])])])}}});const Le={class:"article_detail_view"},Te={class:"article_container"},Ue={class:"article_content"},Re={class:"head"},Ve={class:"title"},Ne={class:"date"},Oe={class:"tags"},ze={class:"body"},Me={class:"article_info"},Se={class:"user_info"},je={class:"user"},qe={class:"data"},Ke={class:"item"},He={class:"item"},Je={class:"item"},Pe={class:"item"},Ge={class:"catalog"},Qe={class:"body scrollbar"},We={class:"article_action"},ct=N({__name:"index",setup(h){const E=document.documentElement,f=O(),m=oe(),t=U({id:0,createdAt:"",updatedAt:"",title:"",abstract:"",content:"",categoryID:0,categoryName:"",tags:[],coverURL:"",userID:0,readCount:0,likeCount:0,commentCount:0,collectCount:0,openForComment:!1,status:0,username:"",userNickname:"",userAvatarURL:"",isLiked:!1,isCollected:!1});async function u(){const l=await Y(Number(m.params.id));if(l.code){c.error(l.msg);return}Object.assign(t,l.data),setTimeout(B,2e3)}async function B(){const l=await Z(t.id);if(l.code){c.error(l.msg);return}}K(()=>m.params.id,()=>{u()},{immediate:!0}),ne(()=>{const l=m.query.id;setTimeout(()=>{if(l){const o=document.getElementById(l);o&&document.documentElement.scrollTo({top:o.offsetTop,behavior:"smooth"})}},500)});const D=x(!1);function I(){document.documentElement.scrollTop>=210?D.value=!0:D.value=!1}window.addEventListener("scroll",I),se(()=>{window.removeEventListener("scroll",I)});async function _(){if(!f.isLogin){q({reload:!0});return}const l=await W(t.id);if(l.code){c.error(l.msg);return}c.success(l.msg),t.isLiked=!t.isLiked,t.isLiked?t.likeCount++:t.likeCount--}const n=x(!1);async function s(){if(!f.isLogin){q({reload:!0});return}n.value=!0}async function p(l){const o=await X({articleID:t.id,collectionID:l});if(o.code){c.error(o.msg);return}c.success(o.msg),o.msg==="\u6536\u85CF\u6210\u529F"?(t.isCollected=!0,t.collectCount++):t.collectCount--}function v(){document.documentElement.scrollTo({top:0,behavior:"smooth"})}const w=x();function L(){const o=document.querySelector(".add_comment").offsetTop;document.documentElement.scrollTo({top:o,behavior:"smooth"}),setTimeout(()=>{w.value.focus()},800)}return(l,o)=>{const R=k("a-tag"),i=k("a-avatar");return r(),b("div",Le,[d(J,{"no-scroll":""}),d(P,null,{default:y(()=>[d(De,{"article-id":t.id,onSelect:p,visible:n.value,"onUpdate:visible":o[0]||(o[0]=C=>n.value=C)},null,8,["article-id","visible"]),e("div",Te,[e("div",Ue,[e("div",Re,[e("div",Ve,[e("span",null,g(t.title),1),t.userID===a(f).userInfo.userID?(r(),$(a(ie),{key:0,style:{"margin-left":"10px",cursor:"pointer"},title:"\u53BB\u7F16\u8F91",onClick:o[1]||(o[1]=C=>a(fe)(t.id))})):A("",!0)]),e("div",Ne,g(a(ae)(t.createdAt)),1),e("div",Oe,[(r(!0),b(M,null,z(t.tags,C=>(r(),$(R,null,{default:y(()=>[F(g(C),1)]),_:2},1024))),256))])]),e("div",ze,[d(a(G),{id:`md_${t.id}`,theme:a(j),"model-value":t.content},null,8,["id","theme","model-value"])])]),t.openForComment?(r(),$(xe,{key:0,ref_key:"articleCommentRef",ref:w,"article-id":Number(a(m).params.id)},null,8,["article-id"])):A("",!0)]),e("div",Me,[e("div",Se,[e("div",je,[d(i,{size:60,"image-url":t.userAvatarURL,onClick:o[2]||(o[2]=C=>a(V)(t.userID))},null,8,["image-url"])]),e("div",{class:"nick",onClick:o[3]||(o[3]=C=>a(V)(t.userID))},g(t.userNickname),1),e("div",qe,[e("div",Ke,[e("span",null,g(t.readCount),1),o[4]||(o[4]=e("span",null,[e("i",{class:"iconfont icon-liulan"})],-1))]),e("div",He,[e("span",null,g(t.likeCount),1),o[5]||(o[5]=e("span",null,[e("i",{class:"iconfont icon-dianzan_kuai"})],-1))]),e("div",Je,[e("span",null,g(t.collectCount),1),o[6]||(o[6]=e("span",null,[e("i",{class:"iconfont icon-shoucang1"})],-1))]),e("div",Pe,[e("span",null,g(t.commentCount),1),o[7]||(o[7]=e("span",null,[e("i",{class:"iconfont icon-pinglun1"})],-1))])])]),e("div",{class:T(["catalog_action",{isFixed:D.value}])},[e("div",Ge,[o[8]||(o[8]=e("div",{class:"head"},"\u6587\u7AE0\u76EE\u5F55",-1)),e("div",Qe,[d(a(Q),{offsetTop:61,scrollElementOffsetTop:60,editorId:`md_${t.id}`,scrollElement:a(E),theme:a(j)},null,8,["editorId","scrollElement","theme"])])]),e("div",We,[e("i",{title:"\u70B9\u8D5E",onClick:_,class:T(["iconfont icon-dianzan_kuai",{active:t.isLiked}])},null,2),e("i",{title:"\u6536\u85CF",onClick:s,class:T(["iconfont icon-shoucang1",{active:t.isCollected}])},null,2),e("i",{title:"\u56DE\u5230\u9876\u90E8",onClick:v,class:"iconfont icon-zhiding"}),e("i",{title:"\u53BB\u8BC4\u8BBA",onClick:L,class:"iconfont icon-pinglun1"})])],2)])]),_:1})])}}});export{ct as default};
