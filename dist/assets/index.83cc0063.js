import{_ as P,F as G}from"./f_main.7dadb2bd.js";import{o as H,M as Q}from"./index.4e482833.js";import{m as W,n as X,h as Y,o as Z}from"./article_api.274c4acf.js";import{_ as ee}from"./f_avatar.vue_vue_type_script_setup_true_lang.0fd4958c.js";/* empty css                                                 */import{d as V,p as O,a as U,b as x,r as k,o as r,c as A,w as g,f as d,h as e,e as I,g as z,k as b,t as C,i as F,F as M,M as c,n as T,u as a,y as te,J as K,j as oe,l as ne,a0 as se,ap as ie,K as le,A as j,s as q}from"./index.d3d6e18a.js";import{d as ae,a as ce}from"./date.821a5d33.js";import{_ as ue,c as re}from"./f_collect_form_modal.vue_vue_type_script_setup_true_lang.89cbda78.js";import{c as J,d as de,b as me,e as _e}from"./comment_api.3cfdfca1.js";import{_ as pe,a as fe}from"./options.6d6e685c.js";import{g as N,b as ve}from"./go_router.a20b4d25.js";import"./f_theme.vue_vue_type_script_setup_true_lang.eb464556.js";import"./_plugin-vue_export-helper.cdc0426e.js";const Ce={class:"list"},ke={class:"item"},ge={class:"left"},ye={class:"title"},De={class:"count"},Be=V({__name:"f_article_collect_modal",props:{visible:{type:Boolean},articleId:{}},emits:["update:visible","select"],setup(h,{emit:$}){const f=O(),m=h,t=$,u=U({list:[],count:0});function D(){t("update:visible",!1)}async function y(){u.list=[],u.count=0;const p=await re({articleID:m.articleId});if(p.code){c.error(p.msg);return}Object.assign(u,p.data),u.list.length===0&&u.list.push({id:0,createdAt:"",updatedAt:"",title:"\u9ED8\u8BA4\u6536\u85CF\u5939",abstract:"",coverURL:"",userID:f.userInfo.userID,isDefault:!0,articleCount:0,articleUse:!1})}U({});const B=x("");function _(){n.value=!0}const n=x(!1);function i(p){t("select",p.id),D()}return(p,v)=>{const w=k("a-tag"),L=k("a-button"),l=k("a-modal");return r(),A(l,{footer:!1,"body-class":"collect_modal_body scrollbar",title:"\u6536\u85CF\u6587\u7AE0",onBeforeOpen:y,onCancel:D,visible:m.visible},{default:g(()=>[d(ue,{title:B.value,"onUpdate:title":v[0]||(v[0]=o=>B.value=o),visible:n.value,"onUpdate:visible":v[1]||(v[1]=o=>n.value=o),onOk:y},null,8,["title","visible"]),e("div",{class:"add"},[e("div",{class:"inner",onClick:_},v[2]||(v[2]=[e("i",{class:"iconfont icon-jia"},null,-1),e("span",null,"\u521B\u5EFA\u6536\u85CF\u5939",-1)]))]),e("div",Ce,[(r(!0),I(M,null,z(u.list,o=>(r(),I("div",ke,[e("div",ge,[e("div",ye,[b(C(o.title)+" ",1),o.isDefault?(r(),A(w,{key:0,color:"blue"},{default:g(()=>v[3]||(v[3]=[b("\u9ED8\u8BA4\u6536\u85CF\u5939")])),_:1,__:[3]})):F("",!0)]),e("div",De,C(o.articleCount)+"\u7BC7\u6587\u7AE0",1)]),d(L,{onClick:R=>i(o),type:"primary",status:o.articleUse?"danger":"",size:"mini"},{default:g(()=>[b(C(o.articleUse?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"),1)]),_:2},1032,["onClick","status"])]))),256))])]),_:1},8,["visible"])}}});const Ie=["onClick"],be=["onClick"],Fe={key:0,class:"action"},Ae=["onClick"],$e={key:0,class:"apply_comment"},Ee=V({__name:"comment_tree",props:{list:{},line:{}},emits:["ok"],setup(h,{emit:$}){const f=O(),m=$,t=h;function u(n){n.isApply=!n.isApply,n.isApply&&te(()=>{document.querySelector(`.apply_comment_ipt_${n.id} input`).focus()})}async function D(n){var p;if(((p=n.replyContent)==null?void 0:p.trim())===""){c.warning("\u8BF7\u8F93\u5165\u56DE\u590D\u5185\u5BB9");return}const i=await J({content:n.replyContent,articleID:n.articleID,parentID:n.id});if(i.code){c.error(i.msg);return}c.success(i.msg),m("ok")}function y(){m("ok")}async function B(n){const i=await de(n.id);if(i.code){c.error(i.msg);return}c.success(i.msg),n.isLiked=!n.isLiked,n.isLiked?n.likeCount++:n.likeCount--}async function _(n){const i=await me(n.id);if(i.code){c.error(i.msg);return}c.success(i.msg),m("ok")}return(n,i)=>{const p=k("IconDelete"),v=k("a-popconfirm"),w=k("a-avatar"),L=k("a-input"),l=k("a-button"),o=k("comment_tree",!0),R=k("a-comment");return r(!0),I(M,null,z(t.list,s=>(r(),A(R,{class:"comment_tree_com",content:s.content,datetime:a(ae)(s.createdAt)},{actions:g(()=>[e("span",{class:T(["action",{active:s.isLiked}]),onClick:E=>B(s)},[i[0]||(i[0]=e("i",{class:"iconfont icon-dianzan_kuai"},null,-1)),b(" \u70B9\u8D5E\uFF08"+C(s.likeCount)+"\uFF09 ",1)],10,Ie),t.line!=a(f).siteInfo.article.commentLine?(r(),I("span",{key:0,class:"action",onClick:E=>u(s)},[i[1]||(i[1]=e("i",{class:"iconfont icon-pinglun1"},null,-1)),b(" \u56DE\u590D\uFF08"+C(s.replyCount)+"\uFF09 ",1)],8,be)):F("",!0),d(v,{content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u8BC4\u8BBA\u5417\uFF1F",onOk:E=>_(s)},{default:g(()=>[s.userID===a(f).userInfo.userID?(r(),I("span",Fe,[e("i",null,[d(p)]),i[2]||(i[2]=b(" \u5220\u9664 "))])):F("",!0)]),_:2},1032,["onOk"])]),author:g(()=>[e("span",{onClick:E=>a(N)(s.userID)},C(s.userNickname),9,Ae),s.userID!==a(f).userInfo.userID&&s.relation!==1?(r(),A(pe,{key:0,style:{"margin-left":"10px"},options:a(fe),value:s.relation},null,8,["options","value"])):F("",!0)]),avatar:g(()=>[d(w,{onClick:E=>a(N)(s.userID),"image-url":s.userAvatarURL},null,8,["onClick","image-url"])]),default:g(()=>{var E;return[s.isApply?(r(),I("div",$e,[d(L,{modelValue:s.replyContent,"onUpdate:modelValue":S=>s.replyContent=S,class:T(`apply_comment_ipt_${s.id}`),placeholder:`\u56DE\u590D${s.userNickname}`},null,8,["modelValue","onUpdate:modelValue","class","placeholder"]),d(l,{type:"primary",onClick:S=>D(s)},{default:g(()=>i[3]||(i[3]=[b("\u56DE\u590D")])),_:2,__:[3]},1032,["onClick"])])):F("",!0),(E=s.childComments)!=null&&E.length?(r(),A(o,{key:1,line:t.line+1,onOk:y,list:s.childComments},null,8,["line","list"])):F("",!0)]}),_:2},1032,["content","datetime"]))),256)}}});const he={class:"article_comment_com"},we={class:"add_comment"},xe={class:"comment_list"},Le=V({__name:"article_comment",props:{articleId:{}},setup(h,{expose:$}){const f=h,m=U({list:[],count:0});async function t(){const _=await _e(f.articleId);if(_.code){c.error(_.msg);return}m.list=_.data.list,m.count=_.data.count}const u=U({content:"",articleID:f.articleId,parentID:void 0});async function D(){if(u.articleID=f.articleId,u.content.trim()===""){c.warning("\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9");return}const _=await J(u);if(_.code){c.error(_.msg);return}c.success(_.msg),t(),u.content=""}K(()=>f.articleId,()=>{t()},{immediate:!0});const y=x();function B(){y.value.focus()}return $({focus:B}),(_,n)=>{const i=k("a-textarea"),p=k("a-button");return r(),I("div",he,[e("div",we,[d(i,{modelValue:u.content,"onUpdate:modelValue":n[0]||(n[0]=v=>u.content=v),ref_key:"textareaRef",ref:y,onKeydown:oe(D,["enter"]),"auto-size":{minRows:5,maxRows:6},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9"},null,8,["modelValue"]),d(p,{type:"primary",onClick:D,size:"mini"},{default:g(()=>n[1]||(n[1]=[b("\u53D1\u5E03\u8BC4\u8BBA")])),_:1,__:[1]})]),e("div",xe,[d(Ee,{line:1,onOk:t,list:m.list},null,8,["list"])])])}}});const Te={class:"article_detail_view"},Ue={class:"article_container"},Re={class:"article_content"},Ne={class:"head"},Ve={class:"title"},Oe={class:"date"},ze={class:"tags"},Me={class:"body"},Se={class:"article_info"},je={class:"user_info"},qe={class:"user"},Ke={class:"data"},Je={class:"item"},Pe={class:"item"},Ge={class:"item"},He={class:"item"},Qe={class:"catalog"},We={class:"body scrollbar"},Xe={class:"article_action"},dt=V({__name:"index",setup(h){const $=document.documentElement,f=O(),m=ne(),t=U({id:0,createdAt:"",updatedAt:"",title:"",abstract:"",content:"",categoryID:0,categoryName:"",tags:[],coverURL:"",userID:0,readCount:0,likeCount:0,commentCount:0,collectCount:0,openForComment:!1,status:0,username:"",userNickname:"",userAvatarURL:"",isLiked:!1,isCollected:!1});async function u(){const l=await Y(Number(m.params.id));if(l.code){c.error(l.msg);return}Object.assign(t,l.data),setTimeout(D,2e3)}async function D(){const l=await Z(t.id);if(l.code){c.error(l.msg);return}}K(()=>m.params.id,()=>{u()},{immediate:!0}),se(()=>{const l=m.query.id;setTimeout(()=>{if(l){const o=document.getElementById(l);o&&document.documentElement.scrollTo({top:o.offsetTop,behavior:"smooth"})}},500)});const y=x(!1);function B(){document.documentElement.scrollTop>=210?y.value=!0:y.value=!1}window.addEventListener("scroll",B),ie(()=>{window.removeEventListener("scroll",B)});async function _(){if(!f.isLogin){q({reload:!0});return}const l=await W(t.id);if(l.code){c.error(l.msg);return}c.success(l.msg),t.isLiked=!t.isLiked,t.isLiked?t.likeCount++:t.likeCount--}const n=x(!1);async function i(){if(!f.isLogin){q({reload:!0});return}n.value=!0}async function p(l){const o=await X({articleID:t.id,collectionID:l});if(o.code){c.error(o.msg);return}c.success(o.msg),o.msg==="\u6536\u85CF\u6210\u529F"?(t.isCollected=!0,t.collectCount++):t.collectCount--}function v(){document.documentElement.scrollTo({top:0,behavior:"smooth"})}const w=x();function L(){const o=document.querySelector(".add_comment").offsetTop;document.documentElement.scrollTo({top:o,behavior:"smooth"}),setTimeout(()=>{w.value.focus()},800)}return(l,o)=>{const R=k("a-tag");return r(),I("div",Te,[d(P,{"no-scroll":""}),d(G,null,{default:g(()=>[d(Be,{"article-id":t.id,onSelect:p,visible:n.value,"onUpdate:visible":o[0]||(o[0]=s=>n.value=s)},null,8,["article-id","visible"]),e("div",Ue,[e("div",Re,[e("div",Ne,[e("div",Ve,[e("span",null,C(t.title),1),t.userID===a(f).userInfo.userID?(r(),A(a(le),{key:0,style:{"margin-left":"10px",cursor:"pointer"},title:"\u53BB\u7F16\u8F91",onClick:o[1]||(o[1]=s=>a(ve)(t.id))})):F("",!0)]),e("div",Oe,C(a(ce)(t.createdAt)),1),e("div",ze,[(r(!0),I(M,null,z(t.tags,s=>(r(),A(R,null,{default:g(()=>[b(C(s),1)]),_:2},1024))),256))])]),e("div",Me,[d(a(H),{id:`md_${t.id}`,theme:a(j),"model-value":t.content},null,8,["id","theme","model-value"])])]),t.openForComment?(r(),A(Le,{key:0,ref_key:"articleCommentRef",ref:w,"article-id":Number(a(m).params.id)},null,8,["article-id"])):F("",!0)]),e("div",Se,[e("div",je,[e("div",qe,[d(ee,{size:60,"avatar-url":t.userAvatarURL,nickname:t.userNickname,onClick:o[2]||(o[2]=s=>a(N)(t.userID))},null,8,["avatar-url","nickname"])]),e("div",{class:"nick",onClick:o[3]||(o[3]=s=>a(N)(t.userID))},C(t.userNickname),1),e("div",Ke,[e("div",Je,[e("span",null,C(t.readCount),1),o[4]||(o[4]=e("span",null,[e("i",{class:"iconfont icon-liulan"})],-1))]),e("div",Pe,[e("span",null,C(t.likeCount),1),o[5]||(o[5]=e("span",null,[e("i",{class:"iconfont icon-dianzan_kuai"})],-1))]),e("div",Ge,[e("span",null,C(t.collectCount),1),o[6]||(o[6]=e("span",null,[e("i",{class:"iconfont icon-shoucang1"})],-1))]),e("div",He,[e("span",null,C(t.commentCount),1),o[7]||(o[7]=e("span",null,[e("i",{class:"iconfont icon-pinglun1"})],-1))])])]),e("div",{class:T(["catalog_action",{isFixed:y.value}])},[e("div",Qe,[o[8]||(o[8]=e("div",{class:"head"},"\u6587\u7AE0\u76EE\u5F55",-1)),e("div",We,[d(a(Q),{offsetTop:61,scrollElementOffsetTop:60,editorId:`md_${t.id}`,scrollElement:a($),theme:a(j)},null,8,["editorId","scrollElement","theme"])])]),e("div",Xe,[e("i",{title:"\u70B9\u8D5E",onClick:_,class:T(["iconfont icon-dianzan_kuai",{active:t.isLiked}])},null,2),e("i",{title:"\u6536\u85CF",onClick:i,class:T(["iconfont icon-shoucang1",{active:t.isCollected}])},null,2),e("i",{title:"\u56DE\u5230\u9876\u90E8",onClick:v,class:"iconfont icon-zhiding"}),e("i",{title:"\u53BB\u8BC4\u8BBA",onClick:L,class:"iconfont icon-pinglun1"})])],2)])]),_:1})])}}});export{dt as default};
