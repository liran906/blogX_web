import{_ as P,F as G}from"./f_main.845319c4.js";import{o as H,M as Q}from"./index.1adf9ddc.js";import{m as W,n as X,h as Y,o as Z}from"./article_api.90f3bea7.js";import{_ as q}from"./f_avatar.vue_vue_type_script_setup_true_lang.bba7e2c0.js";/* empty css                                                 */import{d as R,p as V,a as U,b as x,r as g,o as r,c as $,w as y,f as d,h as e,e as b,g as O,k as F,t as C,i as A,F as z,M as c,n as T,u as a,y as ee,J as K,j as te,l as ne,a0 as oe,ap as se,K as ie,A as S,s as j}from"./index.402bb782.js";import{d as le,a as ae}from"./date.c30b11a9.js";import{_ as ce,c as ue}from"./f_collect_form_modal.vue_vue_type_script_setup_true_lang.78f67ac7.js";import{c as J,d as re,b as de,e as me}from"./comment_api.89c16aba.js";import{_ as _e,a as pe}from"./options.1ec12f3c.js";import{g as N,b as fe}from"./go_router.9df53f96.js";import"./f_theme.vue_vue_type_script_setup_true_lang.c5bc89c7.js";import"./_plugin-vue_export-helper.cdc0426e.js";const ve={class:"list"},ke={class:"item"},Ce={class:"left"},ge={class:"title"},ye={class:"count"},De=R({__name:"f_article_collect_modal",props:{visible:{type:Boolean},articleId:{}},emits:["update:visible","select"],setup(h,{emit:E}){const f=V(),m=h,t=E,u=U({list:[],count:0});function B(){t("update:visible",!1)}async function D(){u.list=[],u.count=0;const p=await ue({articleID:m.articleId});if(p.code){c.error(p.msg);return}Object.assign(u,p.data),u.list.length===0&&u.list.push({id:0,createdAt:"",updatedAt:"",title:"\u9ED8\u8BA4\u6536\u85CF\u5939",abstract:"",coverURL:"",userID:f.userInfo.userID,isDefault:!0,articleCount:0,articleUse:!1})}U({});const I=x("");function _(){o.value=!0}const o=x(!1);function i(p){t("select",p.id),B()}return(p,v)=>{const w=g("a-tag"),L=g("a-button"),l=g("a-modal");return r(),$(l,{footer:!1,"body-class":"collect_modal_body scrollbar",title:"\u6536\u85CF\u6587\u7AE0",onBeforeOpen:D,onCancel:B,visible:m.visible},{default:y(()=>[d(ce,{title:I.value,"onUpdate:title":v[0]||(v[0]=n=>I.value=n),visible:o.value,"onUpdate:visible":v[1]||(v[1]=n=>o.value=n),onOk:D},null,8,["title","visible"]),e("div",{class:"add"},[e("div",{class:"inner",onClick:_},v[2]||(v[2]=[e("i",{class:"iconfont icon-jia"},null,-1),e("span",null,"\u521B\u5EFA\u6536\u85CF\u5939",-1)]))]),e("div",ve,[(r(!0),b(z,null,O(u.list,n=>(r(),b("div",ke,[e("div",Ce,[e("div",ge,[F(C(n.title)+" ",1),n.isDefault?(r(),$(w,{key:0,color:"blue"},{default:y(()=>v[3]||(v[3]=[F("\u9ED8\u8BA4\u6536\u85CF\u5939")])),_:1,__:[3]})):A("",!0)]),e("div",ye,C(n.articleCount)+"\u7BC7\u6587\u7AE0",1)]),d(L,{onClick:s=>i(n),type:"primary",status:n.articleUse?"danger":"",size:"mini"},{default:y(()=>[F(C(n.articleUse?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"),1)]),_:2},1032,["onClick","status"])]))),256))])]),_:1},8,["visible"])}}});const Be=["onClick"],Ie=["onClick"],be={key:0,class:"action"},Fe=["onClick"],Ae={key:0,class:"apply_comment"},$e=R({__name:"comment_tree",props:{list:{},line:{}},emits:["ok"],setup(h,{emit:E}){const f=V(),m=E,t=h;function u(o){o.isApply=!o.isApply,o.isApply&&ee(()=>{document.querySelector(`.apply_comment_ipt_${o.id} input`).focus()})}async function B(o){var p;if(((p=o.replyContent)==null?void 0:p.trim())===""){c.warning("\u8BF7\u8F93\u5165\u56DE\u590D\u5185\u5BB9");return}const i=await J({content:o.replyContent,articleID:o.articleID,parentID:o.id});if(i.code){c.error(i.msg);return}c.success(i.msg),m("ok")}function D(){m("ok")}async function I(o){const i=await re(o.id);if(i.code){c.error(i.msg);return}c.success(i.msg),o.isLiked=!o.isLiked,o.isLiked?o.likeCount++:o.likeCount--}async function _(o){const i=await de(o.id);if(i.code){c.error(i.msg);return}c.success(i.msg),m("ok")}return(o,i)=>{const p=g("IconDelete"),v=g("a-popconfirm"),w=g("a-input"),L=g("a-button"),l=g("comment_tree",!0),n=g("a-comment");return r(!0),b(z,null,O(t.list,s=>(r(),$(n,{class:"comment_tree_com",content:s.content,datetime:a(le)(s.createdAt)},{actions:y(()=>[e("span",{class:T(["action",{active:s.isLiked}]),onClick:k=>I(s)},[i[0]||(i[0]=e("i",{class:"iconfont icon-dianzan_kuai"},null,-1)),F(" \u70B9\u8D5E\uFF08"+C(s.likeCount)+"\uFF09 ",1)],10,Be),t.line!=a(f).siteInfo.article.commentLine?(r(),b("span",{key:0,class:"action",onClick:k=>u(s)},[i[1]||(i[1]=e("i",{class:"iconfont icon-pinglun1"},null,-1)),F(" \u56DE\u590D\uFF08"+C(s.replyCount)+"\uFF09 ",1)],8,Ie)):A("",!0),d(v,{content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u8BC4\u8BBA\u5417\uFF1F",onOk:k=>_(s)},{default:y(()=>[s.userID===a(f).userInfo.userID?(r(),b("span",be,[e("i",null,[d(p)]),i[2]||(i[2]=F(" \u5220\u9664 "))])):A("",!0)]),_:2},1032,["onOk"])]),author:y(()=>[e("span",{onClick:k=>a(N)(s.userID)},C(s.userNickname),9,Fe),s.userID!==a(f).userInfo.userID&&s.relation!==1?(r(),$(_e,{key:0,style:{"margin-left":"10px"},options:a(pe),value:s.relation},null,8,["options","value"])):A("",!0)]),avatar:y(()=>[d(q,{onClick:k=>a(N)(s.userID),"image-url":s.userAvatarURL,nickname:s.userNickname},null,8,["onClick","image-url","nickname"])]),default:y(()=>{var k;return[s.isApply?(r(),b("div",Ae,[d(w,{modelValue:s.replyContent,"onUpdate:modelValue":M=>s.replyContent=M,class:T(`apply_comment_ipt_${s.id}`),placeholder:`\u56DE\u590D${s.userNickname}`},null,8,["modelValue","onUpdate:modelValue","class","placeholder"]),d(L,{type:"primary",onClick:M=>B(s)},{default:y(()=>i[3]||(i[3]=[F("\u56DE\u590D")])),_:2,__:[3]},1032,["onClick"])])):A("",!0),(k=s.childComments)!=null&&k.length?(r(),$(l,{key:1,line:t.line+1,onOk:D,list:s.childComments},null,8,["line","list"])):A("",!0)]}),_:2},1032,["content","datetime"]))),256)}}});const Ee={class:"article_comment_com"},he={class:"add_comment"},we={class:"comment_list"},xe=R({__name:"article_comment",props:{articleId:{}},setup(h,{expose:E}){const f=h,m=U({list:[],count:0});async function t(){const _=await me(f.articleId);if(_.code){c.error(_.msg);return}m.list=_.data.list,m.count=_.data.count}const u=U({content:"",articleID:f.articleId,parentID:void 0});async function B(){if(u.articleID=f.articleId,u.content.trim()===""){c.warning("\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9");return}const _=await J(u);if(_.code){c.error(_.msg);return}c.success(_.msg),t(),u.content=""}K(()=>f.articleId,()=>{t()},{immediate:!0});const D=x();function I(){D.value.focus()}return E({focus:I}),(_,o)=>{const i=g("a-textarea"),p=g("a-button");return r(),b("div",Ee,[e("div",he,[d(i,{modelValue:u.content,"onUpdate:modelValue":o[0]||(o[0]=v=>u.content=v),ref_key:"textareaRef",ref:D,onKeydown:te(B,["enter"]),"auto-size":{minRows:5,maxRows:6},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9"},null,8,["modelValue"]),d(p,{type:"primary",onClick:B,size:"mini"},{default:y(()=>o[1]||(o[1]=[F("\u53D1\u5E03\u8BC4\u8BBA")])),_:1,__:[1]})]),e("div",we,[d($e,{line:1,onOk:t,list:m.list},null,8,["list"])])])}}});const Le={class:"article_detail_view"},Te={class:"article_container"},Ue={class:"article_content"},Ne={class:"head"},Re={class:"title"},Ve={class:"date"},Oe={class:"tags"},ze={class:"body"},Me={class:"article_info"},Se={class:"user_info"},je={class:"user"},qe={class:"data"},Ke={class:"item"},Je={class:"item"},Pe={class:"item"},Ge={class:"item"},He={class:"catalog"},Qe={class:"body scrollbar"},We={class:"article_action"},rt=R({__name:"index",setup(h){const E=document.documentElement,f=V(),m=ne(),t=U({id:0,createdAt:"",updatedAt:"",title:"",abstract:"",content:"",categoryID:0,categoryName:"",tags:[],coverURL:"",userID:0,readCount:0,likeCount:0,commentCount:0,collectCount:0,openForComment:!1,status:0,username:"",userNickname:"",userAvatarURL:"",isLiked:!1,isCollected:!1});async function u(){const l=await Y(Number(m.params.id));if(l.code){c.error(l.msg);return}Object.assign(t,l.data),setTimeout(B,2e3)}async function B(){const l=await Z(t.id);if(l.code){c.error(l.msg);return}}K(()=>m.params.id,()=>{u()},{immediate:!0}),oe(()=>{const l=m.query.id;setTimeout(()=>{if(l){const n=document.getElementById(l);n&&document.documentElement.scrollTo({top:n.offsetTop,behavior:"smooth"})}},500)});const D=x(!1);function I(){document.documentElement.scrollTop>=210?D.value=!0:D.value=!1}window.addEventListener("scroll",I),se(()=>{window.removeEventListener("scroll",I)});async function _(){if(!f.isLogin){j({reload:!0});return}const l=await W(t.id);if(l.code){c.error(l.msg);return}c.success(l.msg),t.isLiked=!t.isLiked,t.isLiked?t.likeCount++:t.likeCount--}const o=x(!1);async function i(){if(!f.isLogin){j({reload:!0});return}o.value=!0}async function p(l){const n=await X({articleID:t.id,collectionID:l});if(n.code){c.error(n.msg);return}c.success(n.msg),n.msg==="\u6536\u85CF\u6210\u529F"?(t.isCollected=!0,t.collectCount++):t.collectCount--}function v(){document.documentElement.scrollTo({top:0,behavior:"smooth"})}const w=x();function L(){const n=document.querySelector(".add_comment").offsetTop;document.documentElement.scrollTo({top:n,behavior:"smooth"}),setTimeout(()=>{w.value.focus()},800)}return(l,n)=>{const s=g("a-tag");return r(),b("div",Le,[d(P,{"no-scroll":""}),d(G,null,{default:y(()=>[d(De,{"article-id":t.id,onSelect:p,visible:o.value,"onUpdate:visible":n[0]||(n[0]=k=>o.value=k)},null,8,["article-id","visible"]),e("div",Te,[e("div",Ue,[e("div",Ne,[e("div",Re,[e("span",null,C(t.title),1),t.userID===a(f).userInfo.userID?(r(),$(a(ie),{key:0,style:{"margin-left":"10px",cursor:"pointer"},title:"\u53BB\u7F16\u8F91",onClick:n[1]||(n[1]=k=>a(fe)(t.id))})):A("",!0)]),e("div",Ve,C(a(ae)(t.createdAt)),1),e("div",Oe,[(r(!0),b(z,null,O(t.tags,k=>(r(),$(s,null,{default:y(()=>[F(C(k),1)]),_:2},1024))),256))])]),e("div",ze,[d(a(H),{id:`md_${t.id}`,theme:a(S),"model-value":t.content},null,8,["id","theme","model-value"])])]),t.openForComment?(r(),$(xe,{key:0,ref_key:"articleCommentRef",ref:w,"article-id":Number(a(m).params.id)},null,8,["article-id"])):A("",!0)]),e("div",Me,[e("div",Se,[e("div",je,[d(q,{size:60,"avatar-url":t.userAvatarURL,nickname:t.userNickname,onClick:n[2]||(n[2]=k=>a(N)(t.userID))},null,8,["avatar-url","nickname"])]),e("div",{class:"nick",onClick:n[3]||(n[3]=k=>a(N)(t.userID))},C(t.userNickname),1),e("div",qe,[e("div",Ke,[e("span",null,C(t.readCount),1),n[4]||(n[4]=e("span",null,[e("i",{class:"iconfont icon-liulan"})],-1))]),e("div",Je,[e("span",null,C(t.likeCount),1),n[5]||(n[5]=e("span",null,[e("i",{class:"iconfont icon-dianzan_kuai"})],-1))]),e("div",Pe,[e("span",null,C(t.collectCount),1),n[6]||(n[6]=e("span",null,[e("i",{class:"iconfont icon-shoucang1"})],-1))]),e("div",Ge,[e("span",null,C(t.commentCount),1),n[7]||(n[7]=e("span",null,[e("i",{class:"iconfont icon-pinglun1"})],-1))])])]),e("div",{class:T(["catalog_action",{isFixed:D.value}])},[e("div",He,[n[8]||(n[8]=e("div",{class:"head"},"\u6587\u7AE0\u76EE\u5F55",-1)),e("div",Qe,[d(a(Q),{offsetTop:61,scrollElementOffsetTop:60,editorId:`md_${t.id}`,scrollElement:a(E),theme:a(S)},null,8,["editorId","scrollElement","theme"])])]),e("div",We,[e("i",{title:"\u70B9\u8D5E",onClick:_,class:T(["iconfont icon-dianzan_kuai",{active:t.isLiked}])},null,2),e("i",{title:"\u6536\u85CF",onClick:i,class:T(["iconfont icon-shoucang1",{active:t.isCollected}])},null,2),e("i",{title:"\u56DE\u5230\u9876\u90E8",onClick:v,class:"iconfont icon-zhiding"}),e("i",{title:"\u53BB\u8BC4\u8BBA",onClick:L,class:"iconfont icon-pinglun1"})])],2)])]),_:1})])}}});export{rt as default};
