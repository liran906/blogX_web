<script setup lang="ts">
// M
import type {Component} from "vue";
import {IconHome, IconUser, IconSettings} from "@arco-design/web-vue/es/icon";
import F_component from "@/components/common/f_component.vue";
import {ref} from "vue";
import {collapsed} from "@/components/admin/f_menu";
import router from "@/router";
import {useRoute} from "vue-router";
import {watch} from "vue";
import F_menu_item from "@/components/admin/f_menu_item.vue";
import {useI18n} from "vue-i18n";

const route = useRoute()
const {t} = useI18n()

interface MenuType {
  title: string
  name: string
  icon?: string | Component
  children?: MenuType[]
  role?: number
}


const menuList: MenuType[] = [
  {title: t('admin.dashboard'), name: "home", icon: "iconfont icon-shuju"},
  {
    title: t('userCenter.profile'), name: "userCenter", icon: IconUser, children: [
      {title: t('user.profile'), name: "userInfo", icon: "iconfont icon-yonghuxinxi-"}
    ]
  },
  {
    title: t('admin.articleManage'), role: 1, name: "articleManage", icon: "iconfont icon-yonghuguanli", children: [
      {title: t('admin.articleList'), name: "articleList", icon: "iconfont icon-list",}
    ]
  },
  {
    title: t('admin.userManage'), role: 1, name: "userManage", icon: "iconfont icon-wenzhangguanli", children: [
      {title: t('admin.userList'), name: "userList", icon: "iconfont icon-navicon-wzgl",}
    ]
  },
  {
    title: t('admin.systemManage'), role: 1, name: "settingsManage", icon: "iconfont icon-setting", children: [
      {
        title: t('admin.siteConfig'), name: "siteManage", icon: "iconfont icon-zhandianpeizhi", children: [
          {title: t('admin.siteSettings'), name: "siteManageSite", icon: "iconfont icon-wangzhan"},
          {title: t('admin.emailSettings'), name: "siteManageEmail", icon: "iconfont icon-youxiang"},
          {title: t('admin.qqSettings'), name: "siteManageQQ", icon: "iconfont icon-qq"},
          {title: t('admin.aiSettings'), name: "siteManageAi", icon: "iconfont icon-wuguan"},
          {title: t('admin.cloudStorageSettings'), name: "siteManageCloud", icon: "iconfont icon-yuntupian"}, //
        ]
      },
      {title: t('admin.bannerManage'), name: "bannerList", icon: "iconfont icon-banner"},
      {title: t('admin.logList'), name: "logList", icon: "iconfont icon-xitongrizhi"},
    ]
  },
]

function menuItemClick(key: string) {
  router.push({
    name: key
  })
}

const openKeys = ref<string[]>([])
const selectedKeys = ref<string[]>([])

function initRoute() {
  if (route.matched.length >= 3) {
    // 把中间的 name加到 openKeys
    // 1 length - 1
    for (let i = 1; i < route.matched.length - 1; i++) {
      openKeys.value.push(route.matched[i].name as string)
    }
  }

  selectedKeys.value = [route.name as string]
}

watch(() => route.name, () => {
  initRoute()
}, {immediate: true})


</script>

<template>
  <div class="f_menu" :class="{collapsed: collapsed}">
    <div class="f_menu_inner scrollbar">
      <a-menu
          @menu-item-click="menuItemClick"
          v-model:collapsed="collapsed"
          v-model:open-keys="openKeys"
          v-model:selected-keys="selectedKeys"
          show-collapse-button>
        <f_menu_item :list="menuList"></f_menu_item>
      </a-menu>
    </div>

  </div>
</template>

<style lang="less">
.f_menu {
  height: calc(100vh - 90px);
  position: relative;

  &.collapsed {
    .arco-menu-collapse-button {
      left: 48px !important;
    }
  }

  &:hover {
    .arco-menu-collapse-button {
      opacity: 1 !important;
    }
  }

  .f_menu_inner {
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;

    .arco-menu {
      position: inherit;

      .arco-menu-collapse-button {
        top: 50%;
        transform: translate(-50%, -50%);
        left: 240px;
        transition: all .3s;
        opacity: 0;
      }
    }
  }
}
</style>